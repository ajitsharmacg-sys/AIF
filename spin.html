<div class="card position-relative">

  <div class="card position-relative">
  <div v-if="nsoLoading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <div class="card-body">
    <!-- existing form content -->
  </div>
</div>


  .loading-overlay {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}


  <div class="d-flex align-items-center mb-2">
  <h5 class="me-2 mb-0">Customer Details / Promotion Details</h5>

  <span
    v-if="isLoading"
    class="spinner-border text-primary"
    role="status"
    style="width: 1.4rem; height: 1.4rem;"
  ></span>
</div>

<div class="section-title d-flex align-items-center gap-2">
  <span>Promotion Details</span>

  <span
    v-if="isLoading"
    class="spinner-border text-primary"
    role="status"
    style="width: 1.2rem; height: 1.2rem;"
  ></span>

  <small v-if="isLoading && loadingText" class="text-muted">
    [[ loadingText ]]
  </small>
</div>

  <div class="section-title d-flex align-items-center gap-2">
  <span>Customer Details</span>

  <span
    v-if="isLoading"
    class="spinner-border text-primary"
    role="status"
    style="width: 1.2rem; height: 1.2rem;"
  ></span>

  <small v-if="isLoading && loadingText" class="text-muted">
    [[ loadingText ]]
  </small>
</div>


  if (!error_occured) {
    await this.get_aif(aif.aif_id);

    // ✅ ADD THIS LINE
    this.aifs.splice(0, 0, this.aif);

    this.navigate("aif_view");

    this.dialog.reset_to_default()
        .set_title("Progress")
        .set_message("AIF has been successfully created! AIF Id: " + aif.aif_id)
        .set_true_action("Close")
        .show();
}


  // ✅ Replace updated AIF in list (same as tickets)
this.aifs = [
    this.aif,
    ...this.aifs.filter(a => a.aif_id !== this.aif.aif_id)
];

  this.aifs = this.aifs.filter(a => a.aif_id !== deletedId);


  this.aifs[aif.aif_id] = aif;
this.aifs[this.selected_aif.aif_id] = this.selected_aif;








  updateAifInList(updatedAif) {
  if (!this.aifs?.results || !updatedAif?.aif_id) return;

  for (let i = 0; i < this.aifs.results.length; i++) {
    if (this.aifs.results[i].aif_id === updatedAif.aif_id) {
      // replace to keep Vue reactivity
      this.aifs.results[i] = { ...updatedAif };
      return;
    }
  }
}

    this.updateAifInList(this.aif);
if (this.aifs?.results) {
  this.aifs.results.unshift(this.aif);
}

